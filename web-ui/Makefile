# Go Coffee Epic UI - Makefile

.PHONY: help install build start stop clean logs test dev

# Default target
help:
	@echo "ğŸš€ Go Coffee Epic UI - Available Commands:"
	@echo ""
	@echo "ğŸ“¦ Setup & Installation:"
	@echo "  make install     - Install dependencies for frontend and backend"
	@echo "  make build       - Build frontend and backend"
	@echo ""
	@echo "ğŸƒ Development:"
	@echo "  make dev         - Start development servers (frontend + backend)"
	@echo "  make dev-frontend - Start only frontend development server"
	@echo "  make dev-backend  - Start only backend development server"
	@echo ""
	@echo "ğŸ³ Docker:"
	@echo "  make start       - Start all services with Docker Compose"
	@echo "  make stop        - Stop all services"
	@echo "  make restart     - Restart all services"
	@echo "  make logs        - Show logs from all services"
	@echo ""
	@echo "ğŸ§¹ Maintenance:"
	@echo "  make clean       - Clean up containers, images, and volumes"
	@echo "  make test        - Run tests"
	@echo ""

# Install dependencies
install:
	@echo "ğŸ“¦ Installing frontend dependencies..."
	cd frontend && npm install
	@echo "ğŸ“¦ Installing backend dependencies..."
	cd backend && go mod tidy
	@echo "âœ… Dependencies installed!"

# Build applications
build:
	@echo "ğŸ”¨ Building frontend..."
	cd frontend && npm run build
	@echo "ğŸ”¨ Building backend..."
	cd backend && go build -o bin/web-ui-service ./cmd/web-ui-service
	@echo "âœ… Build completed!"

# Development servers
dev:
	@echo "ğŸƒ Starting development servers..."
	@echo "Frontend will be available at: http://localhost:3000"
	@echo "Backend will be available at: http://localhost:8090"
	@echo ""
	@echo "Press Ctrl+C to stop both servers"
	@make -j2 dev-frontend dev-backend

dev-frontend:
	@echo "ğŸ¨ Starting frontend development server..."
	cd frontend && npm run dev

dev-backend:
	@echo "âš™ï¸  Starting backend development server..."
	cd backend && go run ./cmd/web-ui-service/main.go

# Docker operations
start:
	@echo "ğŸš€ Starting Go Coffee Epic UI with Docker..."
	./start.sh

stop:
	@echo "ğŸ›‘ Stopping Go Coffee Epic UI..."
	./stop.sh

restart: stop start

logs:
	@echo "ğŸ“‹ Showing logs from all services..."
	docker-compose -f docker-compose.ui.yml logs -f

# Testing
test:
	@echo "ğŸ§ª Running frontend tests..."
	cd frontend && npm run test
	@echo "ğŸ§ª Running backend tests..."
	cd backend && go test ./...

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning up Docker resources..."
	docker-compose -f docker-compose.ui.yml down -v --remove-orphans
	docker system prune -f
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf frontend/.next
	rm -rf frontend/node_modules/.cache
	rm -rf backend/bin
	@echo "âœ… Cleanup completed!"

# Health check
health:
	@echo "â¤ï¸  Checking service health..."
	@curl -s http://localhost:8090/health | jq . || echo "Backend not responding"
	@curl -s http://localhost:3000 > /dev/null && echo "âœ… Frontend is running" || echo "âŒ Frontend not responding"

# Show status
status:
	@echo "ğŸ“Š Service Status:"
	@docker-compose -f docker-compose.ui.yml ps

# Quick setup for new developers
setup: install build
	@echo "ğŸ‰ Setup completed! You can now run:"
	@echo "  make dev    - for development"
	@echo "  make start  - for Docker deployment"
